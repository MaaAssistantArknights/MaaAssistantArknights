name: Release Package Distribution

on:
  workflow_dispatch:
    inputs:
      maa_version:
        description: 'MAA Version (without "v" prefix)'
        type: string
        required: false
      # mirrorchyan:
      #   description: "Upload to MirrorChyan"
      #   type: boolean
      #   required: false
      #   default: true
      winget:
        description: "Upload to WinGet"
        type: boolean
        required: false
        default: true

jobs:
  # mirrorchyan:
  #   name: Upload to MirrorChyan
  #   if: ${{ github.event.inputs.mirrorchyan != false }}
  #   runs-on: macos-latest

  #   steps:
  #     - name: Upload MAA win x64
  #       uses: MirrorChyan/uploading-action@v1
  #       if: always()
  #       with:
  #         filetype: latest-release
  #         filename: "*MAA-*-win-x64.zip"
  #         mirrorchyan_rid: MAA

  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         owner: ${{ github.repository_owner }}
  #         repo: ${{ github.event.repository.name }}
  #         upload_token: ${{ secrets.MirrorChyanUploadToken }}
  #         os: win
  #         arch: x64

  #     - name: Upload MAA win arm64
  #       uses: MirrorChyan/uploading-action@v1
  #       if: always()
  #       with:
  #         filetype: latest-release
  #         filename: "*MAA-*-win-arm64.zip"
  #         mirrorchyan_rid: MAA

  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         owner: ${{ github.repository_owner }}
  #         repo: ${{ github.event.repository.name }}
  #         upload_token: ${{ secrets.MirrorChyanUploadToken }}
  #         os: win
  #         arch: arm64

  #     - name: Upload MAA macos arm64
  #       uses: MirrorChyan/uploading-action@v1
  #       if: always()
  #       with:
  #         filetype: latest-release
  #         filename: "MAA-*-macos-universal.dmg"
  #         extra_zip: true
  #         mirrorchyan_rid: MAA

  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         owner: ${{ github.repository_owner }}
  #         repo: ${{ github.event.repository.name }}
  #         upload_token: ${{ secrets.MirrorChyanUploadToken }}
  #         os: macos
  #         arch: arm64

  #     - name: Upload MAA macos x64
  #       uses: MirrorChyan/uploading-action@v1
  #       if: always()
  #       with:
  #         filetype: latest-release
  #         filename: "MAA-*-macos-universal.dmg"
  #         extra_zip: true
  #         mirrorchyan_rid: MAA

  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         owner: ${{ github.repository_owner }}
  #         repo: ${{ github.event.repository.name }}
  #         upload_token: ${{ secrets.MirrorChyanUploadToken }}
  #         os: macos
  #         arch: x64

  winget:
    name: Upload to WinGet
    if: ${{ github.event.inputs.winget != false }}
    runs-on: windows-latest

    steps:
      - name: Upload MAA to WinGet
        if: ${{ github.event.inputs.winget != false }}
        env:
          MAA_VERSION: ${{ github.event.inputs.maa_version }}
        uses: vedantmgoyal9/winget-releaser@main
        with:
          identifier: MaaAssistantArknights.MaaAssistantArknights
          version: ${{ env.MAA_VERSION }}
          installers-regex: "-win-"
          max-versions-to-keep: 0
          release-tag: "v${{ env.MAA_VERSION }}"
          fork-user: lucienshawls
          token: ${{ secrets.LUCIENSHAWLS_WINGET }}
