---
icon: mdi:information-outline
---

# MAA 使用说明

## 功能介绍

### 一键长草：刷理智

- 若关卡选择中没有你需要的关卡，请在 MAA 中选择 `当前/上次`，然后在游戏中手动定位关卡
    确保画面停留在 右上角有关卡名和剩余理智，右下角有代理指挥和开始行动 的关卡详情界面。
- 若当前不处于此界面，则 `当前/上次` 会自动进入终端首页右下角“上次作战”的关卡。
- 也可以在 `任务设置` - `刷理智` - `高级设置` 中启用 `手动输入关卡名` 手动输入关卡编号。目前支持导航的关卡有：
    - 全部主线关卡。可在关卡末尾添加 `-NORMAL` 或 `-HARD` 来切换标准或磨难关卡。
    - 龙门币、作战记录的 5 / 6 关，但必须输入 `CE-6` / `LS-6`。MAA 会在第六关无法代理的情况下自动切换至第五关。
    - 技能书、采购凭证、碳本第 5 关，必须输入 `CA-5` / `AP-5` / `SK-5`。
    - 所有芯片本。必须输入完整关卡编号，如 `PR-A-1`。
    - 剿灭作战。必须输入 `Annihilation`。
    - 别传中的 `OF-1` / `OF-F3` / `GT-5`。
    - 当期 SS 活动 后三关。在自动访问 [API](https://ota.maa.plus/MaaAssistantArknights/api/gui/StageActivity.json) 下载更新后会在界面下方显示。
    - 复刻的 SS 活动。输入 `SSReopen-<关卡前缀>` ，可一次性刷完 XX-1~XX-9 关，如 `SSReopen-IC`。

::: details 示例画面
![示例画面](https://github.com/MaaAssistantArknights/MaaAssistantArknights/assets/99072975/2d466efd-142a-4c28-9b2f-06caa08ef9f4)
:::

- `刷理智` 的 `常规设置` 中的 `吃理智药` + `吃源石` 和 `指定次数`、`指定材料` 三个选项为短路开关（或门），即达成三个选项中的任一条件，均会视为任务完成，停止刷理智。

    - `吃理智药` 指定补充几次理智（可能一次吃多瓶药）。
    - `吃源石` 指定碎几颗石头（一次一颗），当仓库中有理智药时不会碎石。
    - `指定次数` 指定刷多少次指定关卡（例如“刷 15 次后停止”）。
    - `指定材料` 指定刷多少个指定材料（例如“获取 5 个固源岩后停止”）。

需要注意，`吃源石` 只会在 `吃理智药` 之后判断，因为 MAA 只有在没有理智药时才会使用源石补充理智。所以在勾选 `吃源石` 之后，需要将 `吃理智药` 的次数设置为大于等于仓库中现有的理智药的值，如 999，以避免跳过 `吃源石` 判断。

::: details 例子
| 吃理智药 | 吃源石 | 指定次数 | 指定材料 | 结果                                                                                                                                   |
| :------: | :----: | :------: | :------: | -------------------------------------------------------------------------------------------------------------------------------------- |
|          |        |          |          | 刷完现有理智即结束。                                                                                                                   |
|    2     |        |          |          | 先刷完现有理智，然后吃一次理智药，一共吃 `2` 次，刷完理智后结束。                                                                      |
|  _999_  |   2    |          |          | 先刷完现有理智，并吃光理智药后，再碎石，一共碎 `2` 次，刷完理智后结束。                                                                |
|          |        |    2     |          | 刷 `2` 次选择的关卡即结束。                                                                                                            |
|          |        |          |    2     | 掉落统计刷到 `2` 个指定的材料即结束。                                                                                                  |
|    2     |        |    4     |          | 在最多吃 `2` 次理智药的情况下，刷 `4` 次选择的关卡即结束。                                                                             |
|    2     |        |          |    4     | 在最多吃 `2` 次理智药的情况下，掉落统计刷到 `4` 个指定的材料即结束。                                                                   |
|    2     |        |    4     |    8     | 在最多吃 `2` 次理智药的情况下，刷 `4` 次选择的关卡即结束。但如果在没刷完 `4` 次之前就获得了 `8` 个指定材料，则会提前结束。             |
|  _999_  |   4    |    8     |    16    | 在最多吃光理智药并碎 `4` 次石头的情况下，刷 `8` 次选择的关卡即结束。但如果在没刷完 `8` 次之前就获得了 `16` 个指定材料，则会提前结束。  |
|          |   2    |          |          | 先刷完现有理智，如果仓库中有理智药则结束，如果没有理智药则碎 `2` 次石，刷完理智后结束。                                                |
|    2     |   4    |          |          | 先刷完现有理智，如果吃完 `2` 次理智药后还有理智药，则结束；如果吃完 ≤`2` 次理智药后没有理智药了，则继续碎 `4` 次石头，刷完理智后结束。 |
:::


- `指定材料` 与 `关卡选择` 是两个互相独立的逻辑。
    - `指定材料` 只是以材料个数作为任务完成依据，并不会自动导航到相应关卡。
- 支持自动勾选 `代理指挥`。
- 支持自动识别并统计材料掉落，同时上传 [企鹅物流数据统计](https://penguin-stats.cn/) 和 [一图流](https://ark.yituliu.cn/)。支持自定义企鹅物流用户 ID。
- 支持掉线后或凌晨 4 点闪断后自动重连并继续任务。
- 支持等级提升后继续任务。
- 代理失败时会放弃本次行动并重新战斗。
- 剿灭相关：
    - MAA 只会通过终端首页右上角剿灭按钮进行跳转，请确保当期剿灭已解锁 `全权委托` 并持有足够数量的 “PRTS 剿灭代理卡”。
    - 在当期剿灭刷新或重新安装明日方舟后，从剿灭 `开始战斗` 页面返回会自动展开 `情报汇总`，请提前关闭此页面以防止任务卡住。
    - 仅建议当期剿灭已“400 杀”的玩家使用 MAA 自动剿灭。
- 连战相关：
    - MAA 目前仅会按照用户设定的次数进行连战，尚未支持自动识别最大连战次数。
    - 若设置的次数过多但理智不足，MAA 会直接进行 `吃理智药` 或 `吃源石` 操作，并继续尝试连战。
    - 若未设置 `吃理智药` 或 `吃源石`，MAA 会直接认为理智不足，终止刷理智任务。若设置了 `剩余理智` ，MAA 会直接开始刷 `剩余理智` 关卡。
- 备选关卡:
    - 备选关卡根据当天是否开放决定是否打该关，即 选择第一个开放关卡进行战斗
    1. 如依次选择 钱本、1-7、经验本：
        - 如果当天开放 钱本、1-7、经验本，则打钱本，不会打1-7 / 经验本。如果玩家此时未解锁钱本代理，则本任务失败
        - 如果当天开放 1-7、经验本，则打1-7，不会打经验本。如果玩家此时未解锁1-7代理，则本任务失败
    2. 如依次选择 剿灭、钱本、1-7，则先尝试剿灭，后续执行逻辑同上；剿灭战斗结果不影响对其余备选关卡的筛选逻辑
- 剩余理智：
    - 在 `刷理智` 任务结束后启动，不受吃理智药、吃源石、指定次数、指定材料、连战次数等的控制，刷完理智即结束。
    - 适用于在 `关卡选择` 关卡理智不足后，继续前往 `剩余理智` 关卡清理剩余的“边角”理智（如前往 1-7）。
    - 亦适用于在连战次数设置过高而理智不足时自动以单次连战刷光理智收尾（设置 1-7 连战 6 次，但只有 30 理智，于是自动转为刷 5 次不连战的 1-7）。
    - 若剩余理智仍然不足则会结束任务（如少于 6 理智）。

### 一键长草：自动公招

- **自动公招 和 公招识别 是两个不同的功能！**
- 自动公招支持使用 `加急许可`，全自动连续公招。请进入 `自动公招` - `任务设置` 中选择 `自动使用加急许可` ，并修改 `每次执行时最大招募次数` 。
- 出 1、5、6 星都会弹出通知提示。
- 公招刷新时自动将公招标签数据上传到 [企鹅物流数据统计](https://penguin-stats.cn/) 和 [一图流](https://ark.yituliu.cn/)。

### 一键长草：基建换班

#### 换班策略

- 自动计算并选择**单设施内的最优解**，支持所有通用类技能和特殊技能组合。
- 支持识别经验书、赤金、源石碎片、芯片，分别使用相应的干员组合。

#### 基建工作心情阈值

- 自动识别心情进度条，将剩余心情百分比小于该阈值的干员进驻宿舍。

#### 特殊说明

- 基建换班目前均为单设施最优解，而非跨设施的全局最优解。
    - 可识别并使用的例子：`巫恋+龙舌兰`、`红云+稀音`。
    - 不可识别并使用的例子：`迷迭香体系`、`红松骑士团`。
- 若 `无人机用途` 选择 `贸易站-龙门币` ，则会额外识别 `巫恋组` 并优先为其使用。
- 会客室仅缺一个线索时，会选择对应线索倾向的干员；其余情况选择通用干员。
- 会客室仅当自有线索满时才会送出线索，并且只送三个。如需自定义单次送线索个数可修改 MAA 文件夹下 `resource/tasks.json` 中的 `SelectClue` - `maxTimes` 字段。
- 开启 `不将已进驻的干员放入宿舍` 设置项可避免 `艾丽妮` 等干员在训练室未训练时被进驻到宿舍，但同时也不会将加工站中心情不满的干员进驻宿舍。
- 控制中枢策略太过复杂，目前只考虑 `阿米娅`、`诗怀雅`、`凯尔希`、`彩虹小队` 及其他心情 +0.05 的干员，后续逐步优化。

#### 自定义基建换班（测试）

- 一图流的大佬们帮忙写了一个 [排班生成器](https://ark.yituliu.cn/tools/schedule)，可参考 [文档](../protocol/base-scheduling-schema.md) 使用。
- MAA 文件夹下 `/resource/custom_infrast/` 中内置了几套理论极限效率的作业，可用作参考。由于其对干员及练度的需求极高，不推荐直接使用。

### 一键长草：获取信用及购物

- 会自动访问好友获取信用点。
- 借助战赚信用：
    - MAA 会使用助战干员通关一次火蓝之心 `OF-1` 关卡，请确认该关卡已解锁。
    - 关卡选择为 `当前/上次` 时不会执行借助战任务。

### 一键长草：自动肉鸽

- MAA 默认选择最新一期主题，可在 `自动肉鸽` - `肉鸽主题` 中更改目标主题。
    - 请在游戏内将对应肉鸽主题置顶在终端处。
    - 请提前手动结束**非目标主题**的探索。
    - 若 MAA 在难度选择界面卡住/反复进出，请手动选择难度再开始任务。
- 设置中可选择分队、开局干员（仅单个干员名）等。
- 支持自动识别干员及练度，并自动选择较优干员及技能。
- 支持识别商店物品，优先购买更强力的收藏品。
- 支持掉线后或凌晨 4 点闪断后自动重连并继续任务。
- 战斗时长超过 5 分钟会自动撤退所有地面单位，超过 6 分钟会自动放弃当局战斗，避免互相刮痧耗时。
- 如果任务出现问题，会自动放弃当次探索并重试。
- 如果多次在同一个位置卡住，请提交 Issue 反馈，并附带日志和截图。

### 切换账号

- 仅支持切换至已登录的账号，使用登录名进行查找，请保证输入内容在所有已登录账号唯一。
    - 官服：`123****8901`，可输入 `123****8901`、`123`、`8901`、`3****8`
    - B 服：`张三`，可输入 `张三`、`张`、`三`

### 自动战斗

- 欢迎使用作业分享站 [prts.plus](https://prts.plus)，[抄作业.com](https://抄作业.com) 使用及分享作业文件。

#### 抄作业

支持任意 `可编队关卡` 和 `保全派驻` 模式的自动战斗。

- 本功能需要在有 `开始行动` 按钮的编队选择界面开始运行。  
    之后在 MAA 左侧上部的框中 `导入本地 JSON 作业文件` 或 `填写作业站神秘代码` 即可导入作业。
    - 另外支持视频识别（α），拖入视频文件即可激活。  
    要求 16:9 画幅 720p 以上画质，无黑边、模拟器边框、异形屏适配等干扰因素。
- `自动编队` 功能会**清空当前编队**并根据作业需要的干员自动完成编队。
    - 可根据个人需要（例如需要使用 `好友助战` 时）取消 `自动编队`，手动编队后开始。
    - 可根据任务需要为自动编队 `追加自定干员` 和 `补充低信赖干员`。
    - 对于【悖论模拟】关卡，必须关闭 `自动编队`，手动选择技能后，在有**开始模拟**按钮的界面开始自动战斗。
    - 对于【保全派驻】关卡，`自动编队` 无效，必须手动完成**初始**任务准备，直到在关卡详情有**开始部署**按钮的界面才能开始自动战斗。
- 可设置 `循环次数`，例如保全。但 MAA 不会借干员，如需借干员请勿使用。
- 可使用 `战斗列表` 功能进行同一区域关卡的自动连续战斗。
    - 战斗列表下方三个按钮从左到右依次为 `批量导入`、`添加关卡`、`清空关卡`。  
    `添加关卡` 右键为添加突袭关卡，`清空关卡` 右键为清空未勾选关卡，
    - 导入作业后，战斗列表下方会出现关卡名，确认正确后再添加该关卡。列表中的关卡可以拖拽调整顺序，勾选是否执行。
    - 开启本功能后改为在**关卡所在的地图界面**开始自动战斗。在理智不足/战斗失败/非三星结算时将停止自动战斗队列。
    - 请确保列表中的关卡在同一区域（只通过左右滑动地图界面就可以导航到）。
- **请务必为优质作业点赞，以提高作业评分并激励作业制作者。**  
![image](https://github.com/MaaAssistantArknights/MaaAssistantArknights/assets/99072975/39e6dd67-2ff1-4023-a2b8-0018673c08aa)

#### 写作业

- 请使用 [作业编辑器](https://prts.plus/create) 制作，可参考 [战斗流程协议](../protocol/copilot-schema.md)。
- 地图坐标获取：
    - 在作业编辑器中填写关卡后，左下角会自动加载可拖动缩放的坐标地图，可点选设置当前干员位置。
    - 填写关卡并导出 JSON 后直接开始行动，会在 MAA 目录下 `debug\map` 中生成覆盖有坐标信息的地图截图。
    - [PRTS.Map](https://map.ark-nights.com/areas)，在设置中将 `坐标展示` 修改为 `MAA` 后使用。
- 支持演习模式。
- 建议在作业描述里填上你的署名（作者名）、参考的攻略视频链接、其他想说的等等。
- 欢迎加入企鹅群 [1169188429](https://jq.qq.com/?_wv=1027&k=QZcGcJ9G) 共同讨论作业制作等问题。

### 仓库识别（测试）

- 若自动跳转失败，请手动切换到仓库 `养成材料` 界面并**滑动到最左侧**后开始功能。
- 目前仅支持导出到[企鹅物流刷图规划器](https://penguin-stats.cn/planner)、[明日方舟工具箱](https://arkntools.app/#/material)、[明日方舟 - 干员培养表](https://ark-nights.com/settings)。
- 也许后面可能会用来做一些更实用的功能。（画饼
- 如您是某个数据站的站长，也欢迎联系我们适配贵站的材料 JSON 协议~

## 设置介绍

除了 `设置` 选项卡 ，Windows 版本的 MAA 里还有 `任务设置` ，点击 `一键长草` 任务列表右侧的 `齿轮` ，就可以在一键长草界面里切换不同的任务设置啦~

### 自定义连接

- 使用 [模拟器内置 adb](./faq.md#关闭现有-adb-进程) 或自行下载 [adb](https://dl.google.com/android/repository/platform-tools-latest-windows.zip) 并解压。
- 进入软件 `设置` - `连接设置`，选择 `adb` 的文件路径，填写 adb 地址（需要填写 IP + 端口，例如 `127.0.0.1:5555`），并选择模拟器类型。

#### 获取端口号

- 方案 1 : 使用 adb 命令查看模拟器端口

    1. 启动**一个**模拟器，并确认没有其他安卓设备连接在此计算机上。
    2. 在存放有 adb 可执行文件的文件夹中启动命令窗口。
    3. 执行以下命令。

    ```sh
    # Windows 命令提示符
    adb devices
    # Windows PowerShell
    .\adb devices
    ```

    以下为输出内容的例子：

    ```sh
    List of devices attached
    127.0.0.1:<端口>   device
    ```

    使用 `127.0.0.1:<端口>` 作为连接地址。若输出 `emulator-****` 请参阅方案 2。

    - 方案 2 : 查找已建立的 adb 连接

    1. 执行方案 1。
    2. 按 `徽标键+S` 打开搜索栏，输入 `资源监视器` 并打开。
    3. 切换到 `网络` 选项卡，在 `侦听端口` 的名称列中查找模拟器进程名，如 `HD-Player.exe`。
    4. 记录模拟器进程的所有侦听端口。
    5. 在 `TCP 连接` 的名称列中查找 `adb.exe`，在远程端口列中与模拟器侦听端口一致的端口即为模拟器调试端口。

### 自动启动多开模拟器

若需要多开模拟器同时操作，可将 MAA 文件夹复制多份，使用 **不同的 MAA**、**同一个 adb.exe**、**不同的连接地址** 来进行连接。
**以[蓝叠国际版](./devices/windows.md)为例**，介绍两种启动多开模拟器的方式。

#### 通过为模拟器 exe 附加命令来进行多开操作

1. 启动**单一**模拟器多开。
2. 打开任务管理器，找到对应模拟器进程，转到详细信息选项卡，右键列首，点击 `选择列`，勾选 `命令行`。
3. 在多出来的 `命令行` 列中找到 `...\Bluestacks_nxt\HD-Player.exe"` 后的内容。
4. 将找到的类似于 `--instance Nougat32` 的内容填写到 `启动设置` - `附加命令` 中。

::: tip
操作结束后建议重新隐藏 `步骤 2` 中打开的 `命令行` 列以防止卡顿
:::

::: details 示例

```text
多开1:
模拟器路径: C:\Program Files\BlueStacks_nxt\HD-Player.exe
附加命令: --instance Nougat32 --cmd launchApp --package "com.hypergryph.arknights"
多开2:
模拟器路径: C:\Program Files\BlueStacks_nxt\HD-Player.exe
附加命令: --instance Nougat32_1 --cmd launchApp --package "com.hypergryph.arknights.bilibili"
```

其中 `--cmd launchApp --package` 部分为启动后自动运行指定包名应用，可自行更改。
:::

#### 通过使用模拟器或应用的快捷方式来进行多开操作

1. 打开多开管理器，新增对应模拟器的快捷方式。
2. 将模拟器快捷方式的路径填入 `启动设置` - `模拟器路径` 中

::: tip
部分模拟器支持创建应用快捷方式，可直接使用应用的快捷方式直接启动模拟器并打开明日方舟
:::

::: details 示例

```text
多开1:
模拟器路径: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\BlueStacks\多开1.lnk
多开2:
模拟器路径: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\BlueStacks\多开2-明日方舟.lnk
```

:::

若使用 `模拟器路径` 进行多开操作，建议将 `启动设置` - `附加命令` 置空。

### 开始前/结束后脚本

- v4.13.0 后支持设置开始前/结束后脚本，可在任务前后自动执行批处理文件。
- 需填写批处理文件即 `*.bat` 的路径。

## 其他说明

- 首页左侧任务可以拖动改变顺序，基建换班设置中设施顺序同理。
- 主界面和设置中的配置更改通常会自动保存，标有 `*` 号或 `（仅一次）` 的选项，以及通过右键单击复选框得到的半选开关都会在 MAA 重启后重置。
- 所有点击操作，都是点击按钮内随机位置，并模拟泊松分布（按钮中心的点击概率最高，距离中心越远，点击概率越低）。
- 底层算法纯 C++ 开发，并设计了多重缓存技术，最大限度降低 CPU 和内存占用。
- 软件支持自动更新 ✿✿ ヽ(°▽°)ノ ✿ ，推荐非杠精的同学使用公测版，一般来说更新快且 bug 少。（什么 MIUI (╯‵□′)╯︵┻━┻
- 如果新版本自动下载失败，可手动下载 OTA 压缩包后直接放到 MAA 目录下，会自动更新的。
- 在 Windows 版本中，MAA 目录下 `config` 文件夹中的 `gui.json` 记录了所有设置，如果下载了新的完整包可以将此文件夹复制到新的 MAA 目录下。
