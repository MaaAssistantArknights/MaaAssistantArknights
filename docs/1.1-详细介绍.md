---
icon: ic:baseline-article
---
# MAA使用说明

## 功能介绍

### 一键长草：刷理智

- 若关卡选择中没有你需要的关卡，请在MAA中选择 `当前/上次`，然后在游戏中手动定位关卡，确保画面停留在有 **开始按钮** 和 **代理指挥** 的关卡详情界面。
  - 若当前不处于此界面，则 `当前/上次` 会自动进入终端首页右下角“上次作战”的关卡。
  - 也可以在 `任务设置` - `刷理智` - `高级设置` 中启用 `手动输入关卡名` 手动输入关卡编号。目前支持导航的关卡有：
    - 全部主线关卡。可在关卡末尾添加 `-NORMAL` 或 `-HARD` 来切换标准或磨难关卡。
    - 龙门币、作战记录的 5 / 6 关，但必须输入 `CE-6` / `LS-6`。MAA 会在第六关无法代理的情况下自动切换至第五关。
    - 技能书、采购凭证、碳本第 5 关，必须输入 `CA-5` / `AP-5` / `SK-5`。
    - 所有芯片本。必须输入完整关卡编号，如 `PR-A-1`。
    - 剿灭作战。必须输入 `Annihilation`。
    - 别传中的 `OF-1` / `OF-F3` / `GT-5`。
    - 当期 SS 活动 后三关。在自动访问 [API](https://ota.maa.plus/MaaAssistantArknights/api/gui/StageActivity.json) 下载更新后会在主界面下方显示。
    - 复刻的 SS 活动。输入 `SSReopen-<关卡前缀>` ，可一次性刷完 XX-1~XX-9 关，如 `SSReopen-IC`。

<details><summary>示例画面</summary>

![示例画面](https://user-images.githubusercontent.com/5153875/196309375-73a93b83-e59b-441c-913f-122d4a9fc46c.png)

</details>

- 主界面上的 `吃理智`、`吃石头`、`指定次数`、`指定材料` 四个选项为**短路开关（或门）**，即达成四个选项中的任一条件，均会视为任务完成，停止刷理智。
  - 其中：
    - `吃理智` 指定吃理智药的 **次数**（通常每次 1 份，即理智耗尽后开始作战时游戏默认选择的一份；小样由于理智较少可能会使用多次，请注意自行计算次数）。
    - `吃石头` 指定碎石多少次（每次 1 颗）。
    - `指定次数` 指定刷多少次图（例如“刷 15 次后停止”）。
    - `指定材料` 指定刷多少个指定的材料（例如“获取 5 个固源岩后停止”）。

|  例 | 吃理智药 |  吃石头 | 指定次数  | 指定材料 | 结果                                                                                                                                                    |
|:---:|:-------:|:-------:|:-------:|:-------:|---------------------------------------------------------------------------------------------------------------------------------------------------------|
|  A  |   999   |    10   |    1    |    x    | 会尝试吃理智药和/或石头，直到刷满 **一次**，满足了 `指定次数：1` 的条件，即视为任务完成，停止刷理智；如果一开始理智药不够、石头不够、现有的理智也不够就会不刷图自动结束。|
|  B  |    x    |    x    |   100   |    x    | 会尝试刷满100次，但在当前可用理智全部刷完后（可能只刷了几次），由于满足了 `不吃理智药` 、 `不吃石头` 的条件，无理智可用，视为任务完成，停止刷理智。                    |
|  C  |    1    |    x    |   100   |    x    | 会尝试刷满100次，期间最多吃 1 次理智药，如果吃了一次理智药理智也刷完了，由于满足了 `吃理智药：1` 、 `不吃石头` 的条件，无理智可用，视为任务完成，停止刷理智。           |
|  D  |   999   |    x    |   100   |3 个固源岩| 会尝试刷满100次，期间会吃 999 次理智药，但如果在这期间累计刷出了3个固源岩，由于满足了 `指定材料：3个固源岩` 的条件，视为任务完成，停止刷理智。                        |

- `指定材料` 与 `关卡选择` 是两个互相独立的逻辑。
  - `指定材料` 只是以材料个数作为任务完成依据，并不会自动导航到相应关卡。
- 支持自动勾选  `代理指挥`。
- 支持自动识别并统计材料掉落，同时上传 [企鹅物流数据统计](https://penguin-stats.cn/)。支持自定义企鹅物流用户 ID。
- 支持掉线后或凌晨 4 点闪断后自动重连并继续任务。
- 支持等级提升后继续任务。
- 代理失败时会放弃本次行动并重新战斗。
- 剿灭相关：
  - MAA 会通过终端首页右上角剿灭按钮进行跳转，请确认当期剿灭已解锁 `全权委托` 并持有足够数量的 “PRTS剿灭代理卡”。
  - 在当期剿灭刷新或重新安装明日方舟后，从剿灭 `开始战斗` 页面返回会自动展开 `情报汇总`，请提前关闭此页面以防止任务卡住。
  - 仅建议当期剿灭 **已“400 杀”** 的玩家使用 MAA 自动剿灭。
- 剩余理智相关：
  - 在 `关卡选择` 关卡理智不足后，继续前往 `剩余理智` 关卡清理剩余的“边角”理智（如 1-7）。
  - 若剩余理智仍然不足则会结束任务（如少于 6 理智）。

### 一键长草：自动公招

- **自动公招 和 公招识别 是两个不同的功能！**
- 自动公招支持使用 `加急许可`，全自动连续公招。请进入 `自动公招` - `任务设置` 中选择 `自动使用加急许可` ，并修改 `每次执行时最大招募次数` 。
- 出 1、5、6 星都会弹出通知提示。
- 公招刷新时自动将公招标签数据上传到 [企鹅物流数据统计](https://penguin-stats.cn/) 和 [材料一图流](https://yituliu.site/)。

### 一键长草：基建换班

#### 换班策略

- 自动计算并选择 **单设施内的最优解**，支持所有通用类技能和特殊技能组合。
- 支持识别经验书、赤金、源石碎片、芯片，分别使用相应的干员组合。

#### 基建工作心情阈值

- 自动识别心情进度条，将剩余心情百分比小于该阈值的干员进驻宿舍。

#### 特殊说明

- 基建换班目前均为单设施最优解，而非跨设施的全局最优解。
  - 可识别并使用的例子：`巫恋+龙舌兰`、`红云+稀音`。
  - 不可识别并使用的例子：`迷迭香体系`、`红松骑士团`。
- 若 `无人机用途` 选择 `贸易站-龙门币` ，则会额外识别 `巫恋组` 并优先为其使用。
- 会客室仅缺一个线索时，会选择对应线索倾向的干员；其余情况选择通用干员。
- 会客室仅当自有线索满时才会送出线索，并且只送三个。如需自定义单次送线索个数可修改 MAA 文件夹下 `resource/tasks.json` 中的 `SelectClue` - `maxTimes` 字段。
- 开启 `不将已进驻的干员放入宿舍` 设置项可避免 `艾丽妮` 等干员在训练室未训练时被进驻到宿舍，但同时也不会将加工站中心情不满的干员进驻宿舍。
- 控制中枢策略太过复杂，目前只考虑 `阿米娅`、`诗怀雅`、`凯尔希`、`彩虹小队` 及其他心情 +0.05 的干员，后续逐步优化。

#### 自定义基建换班（测试）

- 一图流的大佬们帮忙写了一个 [排班生成器](https://yituliu.site/tools/maa)，可参考 [文档](3.6-基建排班协议.md) 使用。
- 在 MAA 文件夹下 `/resource/custom_infrast/` 中内置了几套**理论极限效率**的作业，可用作参考。由于其对干员及练度的需求极高，不推荐直接使用。

### 一键长草：获取信用及购物

- 会自动访问好友获取信用点。
- 借助战赚信用：
  - MAA 会使用助战干员通关一次火蓝之心 `OF-1` 关卡，请确认该关卡已解锁，以免任务出错。
  - 关卡选择为 `当前/上次` 时不会执行借助战任务。

### 一键长草：自动肉鸽

- MAA 默认选择最新一期主题，可在 `自动肉鸽` - `任务设置` 中更改目标主题。
  - 请在游戏内将对应肉鸽主题置顶在终端处。
  - 请提前手动结束**非目标主题**的探索。
  - 若 MAA 在难度选择界面卡住/反复进出，请手动选择难度再开始任务。
- 设置中可选择分队、开局干员（仅单个干员名）等。
- 支持自动识别干员及练度，并自动选择较优干员及技能。
- 支持识别商店物品，优先购买更强力的收藏品。
- 支持掉线后或凌晨 4 点闪断后自动重连并继续任务。
- 如果需要刷特定结局，请根据自己的结局（对应文件名中的`ending`）和投资策略（对应文件名中是否包含`_for_deposit`），手动用`\resource\roguelike\Mizuki\ending`中对应结局的`encounter`或者`encounter_for_deposit`文件**改名**并替换掉`\resource\roguelike\Mizuki`中的`encounter`文件（请**手动备份**好原始配置避免问题，暂时只支持水月，如果大家对萨米和傀影有需求可以提issue）。
- 战斗时长超过 5 分钟会自动撤退所有地面单位，超过 6 分钟会自动放弃当局战斗，避免互相刮痧耗时。
- 如果任务出现问题卡住，会自动放弃当次探索并重试。
- 如果多次在同一个位置卡住，请提交 Issue 反馈，并附带日志和截图。

### 切换账号

- 仅支持切换至已登录的账号，使用登录名进行匹配，保证输入内容在所有已登录账号唯一即可
  - 官服：123****4567，可输入 123****4567、4567、123、3****4567
  - B服：张三，可输入 张三、张、三

### 自动战斗

- 欢迎使用作业分享站 [prts.plus](https://prts.plus)，[抄作业.com](https://抄作业.com) 使用及分享作业文件。

#### 抄作业

- 本功能需要在有 `开始行动` 的编队选择界面开始运行。
- 若需要选择助战，请关闭 `自动编队` 选项并手动编队后开始。
- **请务必为优质作业点赞，以提高作业评分并激励作业制作者。**

![image](https://user-images.githubusercontent.com/18511905/189662951-5f9d6d88-3c23-49b3-a58f-c35388b2d5d7.png)

#### 写作业

- 请使用 [作业编辑器](https://prts.plus/create) 制作，可参考 [战斗流程协议](3.3-战斗流程协议.md)。
- 地图坐标获取：
  - 在作业编辑器中填写关卡后，左下角会自动加载可拖动缩放的坐标地图，可点选设置当前干员位置。
  - 填写关卡并导出 JSON 后直接开始行动，会在 MAA 目录下 `debug\map` 中生成覆盖有坐标信息的地图截图。
  - [PRTS.Map](https://map.ark-nights.com/areas)，在设置中将 `坐标展示` 修改为 `MAA` 后使用。
- 支持演习模式。
- 建议在作业描述里填上你的署名（作者名）、参考的攻略视频链接、其他想说的等等。
- 欢迎加入企鹅群 [1169188429](https://jq.qq.com/?_wv=1027&k=QZcGcJ9G) 与我们一起讨论作业制作等问题。

#### 作业视频识别

- 将视频文件放入自动战斗中，点击 “开始” 启动作业视频识别。
- 仅支持 16:9 的 720p 或更高分辨率的视频。视频内容不能出现黑框、异形屏校正、模拟器边框等其他干扰元素。

### 仓库识别（测试）

- 若自动跳转失败，请手动切换到仓库 `养成材料` 界面并**滑动到最左侧**后开始功能。
- 目前仅支持导出到[企鹅物流刷图规划器](https://penguin-stats.cn/planner)、[明日方舟工具箱](https://arkn.lolicon.app/#/material)、[明日方舟 - 干员培养表](https://ark-nights.com/settings)。
- 也许后面可能会用来做一些更实用的功能。（画饼
- 如您是某个数据站的站长，也欢迎联系我们适配贵站的材料 JSON 协议。

## 设置介绍

除了 `设置` 选项卡 ，Windows 版本的 MAA 里还有 `任务设置` ，点击 `一键长草` 的任务列表右侧的 `齿轮` ，就可以在一键长草界面里切换不同的任务设置啦~

要注意点击 `常规设置` `高级设置` 也会切换 `任务设置`哟~

### 自定义连接

- 使用 [模拟器内置 adb](1.2-常见问题.md#方式-1--确认-adb-及连接地址正确) 或自行下载 [adb](https://dl.google.com/android/repository/platform-tools-latest-windows.zip) 并解压。
- 进入软件 `设置` - `连接设置`，选择 `adb` 的文件路径，填写 adb 地址（需要填写 IP + 端口，例如 `127.0.0.1:5555`），并选择模拟器类型。

#### 获取端口号

- 方案 1 : 使用 adb 命令查看模拟器端口
  1. 启动**一个**模拟器，并确认没有其他安卓设备连接在此计算机上。
  2. 在存放有 adb 可执行文件的文件夹中启动命令窗口。
  3. 执行以下命令。

  ```sh
  # Windows 命令提示符
  adb devices
  # Windows PowerShell
  .\adb devices
  ```

  以下为输出内容的例子：

  ```sh
  List of devices attached
  127.0.0.1:<端口>   device
  ```

  使用 `127.0.0.1:<端口>` 作为连接地址。若输出 `emulator-****` 请参阅方案 2。

- 方案 2 : 查找已建立的 adb 连接

    1. 执行方案 1。
    2. 按 `徽标键+S` 打开搜索栏，输入 `资源监视器` 并打开。
    3. 切换到 `网络` 选项卡，在 `侦听端口` 的名称列中查找模拟器进程名，如 `HD-Player.exe`。
    4. 记录模拟器进程的所有侦听端口。
    5. 在 `TCP 连接` 的名称列中查找 `adb.exe`，在远程端口列中与模拟器侦听端口一致的端口即为模拟器调试端口。

### 自动启动多开模拟器

- 若需要多开模拟器同时操作，可将 MAA 文件夹复制多份，使用 **不同的 MAA**、**同一个 adb.exe**、**不同的连接地址** 来进行连接。
- **以[蓝叠国际版](1.3-模拟器支持.md##-✅-[蓝叠模拟器国际版](https://www.bluestacks.com/tw/index.html)（最稳定👍）)为例**，介绍两种启动多开模拟器的方式。

  - 通过为 `HD-Player.exe` 附加命令来进行多开操作。

    1. 启动**单一**模拟器多开。
    2. 打开任务管理器，找到对应模拟器进程，转到详细信息选项卡，右键列首，点击 `选择列`，勾选 `命令行`。
    3. 在多出来的 `命令行` 列中找到 `...\Bluestacks_nxt\HD-Player.exe"` 后的内容。
    4. 将找到的类似于 `--instance Nougat32` 的内容填写到 `启动设置` - `附加命令` 中。

    注：操作结束后建议重新隐藏 `步骤 2` 中打开的 `命令行` 列以防止卡顿。
    - 例子：

      ```text
      多开1:
      模拟器路径: C:\Program Files\BlueStacks_nxt\HD-Player.exe
      附加命令: --instance Nougat32 --cmd launchApp --package "com.hypergryph.arknights"
      多开2:
      模拟器路径: C:\Program Files\BlueStacks_nxt\HD-Player.exe
      附加命令: --instance Nougat32_1 --cmd launchApp --package "com.hypergryph.arknights.bilibili"
      ```

      其中 `--cmd launchApp --package` 部分为启动后自动运行指定包名应用，可自行更改。

  - 通过使用模拟器或应用的快捷方式来进行多开操作。

    1. 打开多开管理器，新增对应模拟器的快捷方式。
    2. 将模拟器快捷方式的路径填入 `启动设置` - `模拟器路径` 中。

    注：部分模拟器支持创建应用快捷方式，可直接使用应用的快捷方式直接启动模拟器并打开明日方舟。
    - 例子：

      ```text
      多开1:
      模拟器路径: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\BlueStacks\多开1.lnk
      多开2:
      模拟器路径: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\BlueStacks\多开2-明日方舟.lnk
      ```

    若使用 `模拟器路径` 进行多开操作，建议将 `启动设置` - `附加命令` 置空。

### 开始前/结束后脚本

- v4.13.0 后支持设置开始前/结束后脚本，可在任务前后自动执行批处理文件。
- 需填写批处理文件即 `*.bat` 的路径。

## 其他说明

- 首页左侧任务可以拖动改变顺序，基建换班设置中设施顺序同理。
- 主界面和设置中更改的配置一般都会自动保存，含有 `*` 号的选项会在重启后重置。
- 所有点击操作，都是点击按钮内随机位置，并模拟泊松分布（按钮中心的点击概率最高，距离中心越远，点击概率越低）。
- 底层算法纯 C++ 开发，并设计了多重缓存技术，最大限度降低 CPU 和内存占用。
- 软件支持自动更新 ✿✿ヽ(°▽°)ノ✿ ，推荐非杠精的同学使用公测版，一般来说更新快且 bug 少。（什么 MIUI (╯‵□′)╯︵┻━┻
- 如果新版本自动下载失败，可手动下载 OTA 压缩包后直接放到 MAA 目录下，会自动更新的。
- 在 Windows 版本中，MAA 目录下 `config` 文件夹中的 `gui.json` 记录了所有设置，如果下载了新的完整包可以将此文件夹复制到新的 MAA 目录下。（如果复制后启动报错可尝试恢复 `bak` 备份文件或删除后重新设置）。
