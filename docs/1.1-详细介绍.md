# MAA使用说明

## 功能介绍

### 刷理智

- 若选项中没有你需要的关卡，请手动进入游戏 **蓝色开始按钮** 界面，并选择 `当前/上次`。（若当前不处于 **蓝色开始按钮** 界面，则会自动进入游戏中 “上次作战” 的关卡）
- 主界面上的 `吃理智`、`吃石头`、`指定次数`、`指定材料` 四个选项为短路开关，即 **四个选项中的任一条件** 达到，均会视为任务完成，停止刷理智。
  - 其中：
    - `吃理智` 指定吃理智药的 **次数**（通常每次 1 瓶，即理智耗尽后开始作战时游戏默认选择的一瓶；小样由于理智较少可能会默认选择多瓶，请注意自行计算次数）
    - `吃石头` 指定碎石多少次（每次 1 颗）
    - `指定次数` 指定刷多少次图（例如“刷 15 次停手”）
    - `指定材料` 指定刷多少个指定的材料（例如“刷 5 个 固源岩 就停”）

| 例 | 吃理智药 | 吃石头 | 指定次数 |  指定材料 | 结果                                                                                                                                          |
|:--:|:--------:|:------:|:--------:|:---------:|-----------------------------------------------------------------------------------------------------------------------------------------------|
|  1 |    999   |   10   |     1    |     ✖     | 会尝试吃理智药和/或石头，直到刷满 **一次**，满足了`指定次数：1`的条件，即视为任务完成，停止刷理智。                                                                    |
|  2 |     ✖    |    ✖   |    100   |     ✖     | 会尝试刷满100次，但在当前可用理智全部刷完后（可能只刷了几次），由于满足了`不吃理智药`、`不吃石头`的条件，无理智可用，视为任务完成，停止刷理智。           |
|  3 |     1    |    ✖   |    100   |     ✖     | 会尝试刷满100次，期间最多吃 1 次理智药，如果吃了一次理智药理智也刷完了，由于满足了`吃理智药：1`、`不吃石头`的条件，无理智可用，视为任务完成，停止刷理智。 |
|  4 |    999   |    ✖   |    100   | 3个固源岩 | 会尝试刷满100次，期间会吃 999 次理智药，但如果在这期间累计刷出了3个固源岩，由于满足了`指定材料：3个固源岩`的条件，视为任务完成，停止刷理智。                             |
- 关卡选择可在 `设置` - `界面设置` 中启用 `手动输入关卡名`，支持全部主线关卡 + 原先下拉列表中的关卡，如 `1-7`, `S3-2`, `CE-6` 等
- 支持识别并显示材料掉落，且会自动上传 [企鹅物流数据统计](https://penguin-stats.cn/)，并可设置企鹅用户 ID
- `指定材料` 与 `关卡选择` 是两个互相独立的逻辑。
  - `指定材料` 只是以材料个数作为任务完成依据，并不是说你指定了材料就会帮你导航到对应关卡
- 掉线后会重连，继续刷上次的图；凌晨 4 点刷新后也会重连，继续刷上次的图
- 支持剿灭模式自动使用 `全权委托`
- 支持打完升级了的情况；支持代理失败的情况，会自动放弃本次行动
- 支持剩余理智清空
  - 主任务刷完后，自动跳到指定关卡清理剩余的“边角”理智（如剩下的理智拿来刷 1-7）
  - 如果剩余理智不够清空（比如要刷 1-7 但连6理智都不够）则会立即结束任务

### 基建换班

#### 换班策略

自动计算并选择 **单设施内的最优解**，支持所有通用类技能和特殊技能组合；支持识别经验书、赤金、原石碎片、芯片，分别使用不同的干员组合！

#### 基建工作心情阈值

识别心情进度条的百分比；心情小于该阈值的干员，不会再去上班，直接进驻宿舍。

#### 特殊说明

- 基建换班目前均为单设施最优解，但非跨设施的全局最优解。例如：`巫恋+龙舌兰`、`红云+稀音` 等这类单设施内的组合，都是可以正常识别并使用的；`迷迭香`、`红松骑士团` 这类多个设施间联动的体系，暂不支持使用。
- 若 `无人机用途` 选择 `贸易站-龙门币` ，则将额外识别是否有 `巫恋组`，并优先为其使用。
- 会客室仅缺一个线索时，会选择对应流派的干员；否则会选择通用干员。
- 会客室仅当自有线索满时，才会送出线索，并且只送三个。有需要的同学可自行修改 `resource/tasks.json` 中 `SelectClue` - `maxTimes` 字段，自定义送出个数。
- 若不希望 `艾丽妮` 等干员在训练室未训练时被进驻到宿舍，可在设置中打开 `不将已进驻干员放入宿舍`。但可能会带来加工站中心情不满的干员也不进驻宿舍的问题。
- 控制中枢策略太过复杂，目前只考虑 `阿米娅`、`诗怀雅`、`凯尔希`、`彩虹小队` 及其他心情 +0.05 的干员，后续逐步优化。
- 部分异格干员会在基建内产生冲突，请留意辅助界面上是否有提示 “干员冲突”，若有请手动再查看下基建换班情况（可能会有某个设施没人）

#### 自定义基建换班（测试功能）

一图流的大佬们帮忙写了一个 [排班生成器](https://yituliu.site/riicCal/)，请参考 [文档](3.6-基建排班协议.md) 使用  
在 `resource/custom_infrast` 中内置了几套极限效率的作业，也可用作参考

### 公开招募识别

- 自动公招和公招识别是两个独立的功能！
- 自动公招支持使用 `加急许可`，全自动连续公招！请进入设置中选择~
- 出 5、6 星都会有弹出通知提示
- 自动公招时自动选取数据上传 [企鹅物流数据统计](https://penguin-stats.cn/) 和 [素材获取一图流](https://yituliu.site/)

### 自动肉鸽功能

- 请在设置中选择 `傀影/水月` 主题
- 设置中可选择分队、开局干员（仅单个干员名）等
- 支持自动识别干员及练度，并自动选择较优干员及技能
- 支持识别商店物品，优先购买更厉害的收藏品
- 支持掉线重连、支持凌晨 4 点更新后继续回去刷
- 战斗过程中如果刮痧了一直打不完，超过 5 分钟会自动撤退所有地面单位的；超过 6 分钟会自动放弃当局战斗，不会卡住的
- 如果软件出现 bug 卡住了，会自动放弃当次探索并重试。但如果经常在某个地方卡住然后放弃、严重影响效率的，欢迎提个 issue 反馈一下~

### 自动抄作业

欢迎使用作业分享站 www.抄作业.com, www.prts.plus 分享/使用 作业文件！

#### 抄作业

- 本功能需要在有 `开始行动` 的关卡入口界面开始运行
- 若需要选择助战等，关闭 `自动编队` 功能，并手动编队后再开始即可
- 记得在作业分享站上给好用的作业点赞哦！

![image](https://user-images.githubusercontent.com/18511905/189662951-5f9d6d88-3c23-49b3-a58f-c35388b2d5d7.png)

#### 写作业

- MAA 目录下有简易的制作器，可以结合 [文档](3.3-战斗流程协议.md) 使用
- 地图坐标获取：填写 `stage_name` 后直接开一局，会在目录下生成 `map.png`, 可以用于参考。也可参考 [PRTS.map](https://map.ark-nights.com/) 网站，在设置中将 `坐标展示` 修改为 `MAA` 后使用
- 支持演习模式，不用一直浪费理智测试的
- 欢迎使用作业分享站 www.抄作业.com, www.prts.plus 分享自己的作业！
- 推荐在作业描述里填上你自己的名字（作者名）、参考的攻略视频 url, 其他想说的等等

### 仓库识别

初版功能，请从仓库 `养成材料` 界面开始功能。目前仅支持导出到几个数据站，后面可能会用来做一些更实用的功能（画饼  
如您是某个数据站站长，也欢迎联系我们适配贵站的材料 JSON 协议~

### 其他乱七八糟的说明

- 主界面上要执行的任务，是可以拖动改变顺序的。同样设置中基建换班的顺序，也是可以拖动改变的。
- 主界面和设置中更改的配置一般都会自动保存，含有 * 号的选项除外。
- 所有点击操作，都是点击按钮内随机位置，并模拟泊松分布（按钮偏中间位置点的概率大，越往旁边点到的概率越小）。
- 底层算法纯 C++ 开发，并设计了多重的缓存技术，最大限度降低 CPU 和内存占用。
- 软件支持自动更新 ✿✿ヽ(°▽°)ノ✿ 推荐非杠精的同学使用测试版，一般来说更新快且 bug 少（什么 MIUI (╯‵□′)╯︵┻━┻
- 如果新版本自动下载失败，可手动下载后，直接把压缩包放到同目录下，会自动更新的。

## 其他功能

若您有多个模拟器等需要双开、多开同时操作，可将 MAA 文件夹复制多份，使用 **同一个 adb** 及 **不同的 adb 地址** 来进行连接后操作。
