---
order: 7
icon: devicon-plain:githubactions
---

# CI 시스템 분석

MAA는 웹사이트 구축, 자동 리소스 업데이트, 최종 파일 빌드 및 버전 릴리스 등 다양한 자동화 작업을 수행하기 위해 GitHub Actions을 활용합니다. 시간이 지남에 따라 이러한 CI 워크플로우는 점점 더 중첩되었으며, 일부는 다른 저장소와도 연결되어 있습니다. 이 문서는 MAA의 CI 시스템을 개선하고자 하는 분들에게 간략한 소개를 제공하는 것을 목표로 합니다.

이 문서를 읽기 전에, MAA의 프로젝트 구조와 구성 요소에 대한 기본적인 이해가 있는 것이 좋습니다.

::: tip
이 페이지에서 CI 파일명을 검색하여 보고 싶은 섹션으로 빠르게 이동할 수 있습니다
:::

워크플로우 파일은 `.github/workflows`에 저장되어 있으며, 기능에 따라 다음과 같이 분류할 수 있습니다:

+ [코드 테스팅](#코드-테스팅)
+ [코드 빌딩](#코드-빌딩)
+ [버전 릴리스](#버전-릴리스)
+ [리소스 업데이트](#리소스-업데이트)
+ [웹사이트 빌딩](#웹사이트-빌딩)
+ [이슈 관리](#이슈-관리)
+ [풀 리퀘스트 관리](#풀-리퀘스트-관리)
+ [MirrorChyan 관련](#mirrorchyan-관련)
+ [기타](#기타)

또한, [pre-commit.ci](https://pre-commit.ci/)를 사용하여 자동 코드 포맷팅과 이미지 리소스 최적화를 구현합니다. PR을 제출한 후 자동으로 실행되며 일반적으로 특별한 주의가 필요하지 않습니다.

## GitHub Action 섹션

### 코드 테스팅

`smoke-testing.yml`

이 워크플로우는 주로 MaaCore의 기본 테스트를 담당하며, 리소스 파일 로딩, 간단한 작업 실행 테스트 등이 포함됩니다.

테스트 케이스가 오랫동안 업데이트되지 않았기 때문에, 이 워크플로우는 현재 주로 리소스 파일에 오류가 없고 MaaCore 코드에 치명적인 오류(빌드에 영향을 미치는 종류)가 없는지 확인하는 데 사용됩니다.

### 코드 빌딩

`ci.yml`

이 워크플로우는 모든 MAA 구성 요소를 포함한 전체 규모의 코드 빌드를 담당합니다. 빌드 결과물은 실행 가능한 MAA입니다.

필수적인 MaaCore 외에도, Windows 빌드 산출물에는 MaaWpfGui, macOS 빌드 산출물에는 MaaMacGui, Linux 빌드 산출물에는 MaaCLI가 포함됩니다.

이 워크플로우는 새 커밋과 PR이 있을 때마다 자동으로 실행됩니다. 릴리스 PR에 의해 트리거되면, 빌드 산출물은 직접 릴리스에 사용되며 릴리스가 생성됩니다.

### 버전 릴리스

버전 릴리스는 사용자에게 업데이트를 제공하기 위한 필수 작업으로, 다음 워크플로우로 구성됩니다:

+ `release-nightly-ota.yml` 나이틀리 빌드 릴리스용
+ `release-ota.yml` 안정/베타 버전 릴리스용
  + `gen-changelog.yml` 안정/베타 버전 변경 로그 생성용
  + `pr-auto-tag.yml` 안정/베타 버전 태그 생성용

::: tip
위 파일 이름의 "ota"는 "Over-the-Air"의 약자로, 일반적으로 "증분 업데이트 패키지"라고 부르는 것을 의미합니다. 따라서 MAA의 릴리스 프로세스에는 이전 버전에 대한 OTA 패키지를 빌드하는 단계가 포함됩니다.
:::

#### 나이틀리 빌드

`release-nightly-ota.yml`

이 워크플로우는 매일 UTC 22:00에 자동으로 실행되어 정기적인 나이틀리 릴리스를 보장합니다. 물론, 변경 사항을 확인해야 할 때 수동으로 릴리스를 트리거할 수도 있습니다.

나이틀리 릴리스는 Windows 사용자만 이용할 수 있으며, macOS 및 Linux 사용자는 나이틀리 업데이트를 받을 수 없습니다.

#### 안정/베타 버전

이 두 채널의 릴리스 프로세스는 조금 더 복잡합니다. 릴리스 프로세스를 시뮬레이션하여 각 워크플로우의 역할을 설명하겠습니다:

1. `dev` 브랜치에서 `master` 브랜치로 PR을 생성하고, PR 이름은 `Release v******` 형식을 따릅니다
2. `gen-changelog.yml`은 최근 안정/베타 버전부터 현재 버전까지의 변경 로그를 생성합니다(새 PR 형태로)
3. 변경 로그를 수동으로 조정하고 간략한 설명을 추가합니다
4. PR을 병합하면 `pr-auto-tag.yml`이 트리거되어 태그를 생성하고 브랜치를 동기화합니다
5. Release 이벤트는 master 브랜치에 태그를 지정한 후 `release-ota.yml`을 트리거하여 OTA 패키지를 빌드하고 첨부 파일을 업로드합니다

### 리소스 업데이트

이 섹션의 워크플로우는 주로 MAA의 리소스 업데이트 및 최적화를 담당하며, 구체적으로는:

+ `res-update-game.yml` 정기적으로 실행되어 지정된 저장소에서 게임 리소스를 가져옵니다
+ `sync-resource.yml` 리소스를 MaaResource 저장소에 동기화하여 리소스를 업데이트합니다
+ `optimize-templates.yml` 템플릿 이미지 크기를 최적화합니다

### 웹사이트 빌딩

`website-workflow.yml`

이 워크플로우는 주로 MAA 공식 웹사이트의 빌드 및 게시를 담당하며, 메인 페이지와 문서 구성 요소가 모두 포함됩니다.

웹사이트 게시는 버전 릴리스와 밀접하게 연결되어 있습니다. 웹사이트 구성 요소의 일반적인 수정은 오류가 없는지 확인하기 위한 빌드만 트리거하고, Azure에 대한 공식 배포는 버전 릴리스 중에만 발생합니다.

### 이슈 관리

`issue-checker.yml`

정규식 매칭을 사용하여 이슈에 태그를 지정하고, 이슈 내용을 분류하고 표시하여 쉽게 볼 수 있고 관리할 수 있게 합니다.

`stale.yml`

90일 이상 활동이 없는 버그 이슈를 확인하고, 표시하여 알림을 보냅니다. 7일 후에도 활동이 없으면 이슈가 닫힙니다.

### 풀 리퀘스트 관리

`pr-checker.yml`

이 워크플로우는 PR 커밋 메시지가 [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)를 준수하는지, 그리고 Merge 커밋이 포함되어 있는지 확인합니다. 이러한 조건이 충족되면 알림이 제공됩니다.

### MirrorChyan 관련

MirrorChyan은 유료 업데이트 미러 서비스입니다. 관련 워크플로우는 다음과 같습니다:

+ `mirrorchyan.yml` 업데이트 패키지를 MirrorChyan에 동기화합니다
+ `mirrorchyan_release_note.yml` MirrorChyan용 릴리스 노트를 생성합니다

### 기타

`markdown-checker.yml`

저장소의 모든 마크다운 파일에서 유효하지 않은 링크를 확인합니다

`blame-ignore.yml`

저장소 히스토리를 깨끗하게 유지하기 위해 커밋 메시지에 "blame ignore"가 포함된 커밋을 자동으로 무시합니다

`cache-delete.yml`

PR이 병합된 후 관련 캐시를 지워 캐시 사용량을 절약합니다
