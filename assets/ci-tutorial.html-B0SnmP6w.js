import{_ as a,c as o,b as t,o as r}from"./app-BiD3KttA.js";const l={};function i(p,e){return r(),o("div",null,[...e[0]||(e[0]=[t('<p>MAA 借助 Github Action 完成了大量的自動化工作，包括網站的構建，自動更新資源，最終文件的構建與發版等等過程。隨著時間的推移，這些 CI 逐漸開始嵌套，部分甚至引向了其他的存儲庫。本文檔旨在為想要對 MAA 的 CI 系統做出改進的各位做一個簡要的介紹。</p><p>閱讀本文之前，最好對 MAA 的項目結構以及組成有一個基本的概念。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>你可以通過在本頁面內搜尋 CI 文件名來快速導航到想看的部分</p></div><p>工作流的文件均存放在 <code>.github/workflows</code> 下，各個文件可以按功能分為以下幾部分：</p><ul><li><a href="#%E4%BB%A3%E7%A2%BC%E6%B8%AC%E8%A9%A6">代碼測試</a></li><li><a href="#%E4%BB%A3%E7%A2%BC%E6%A7%8B%E5%BB%BA">代碼構建</a></li><li><a href="#%E4%BB%A3%E7%A2%BC%E5%AE%89%E5%85%A8%E6%AA%A2%E6%9F%A5">代碼安全檢查</a></li><li><a href="#%E7%89%88%E6%9C%AC%E7%99%BC%E5%B8%83">版本發布</a></li><li><a href="#%E8%B3%87%E6%BA%90%E6%9B%B4%E6%96%B0">資源更新</a></li><li><a href="#%E7%B6%B2%E7%AB%99%E6%A7%8B%E5%BB%BA">網站構建</a></li><li><a href="#issues-%E7%AE%A1%E7%90%86">Issues 管理</a></li><li><a href="#pull-requests-%E7%AE%A1%E7%90%86">Pull Requests 管理</a></li><li><a href="#mirrorchyan-%E7%9B%B8%E9%97%9C">MirrorChyan 相關</a></li><li><a href="#%E5%85%B6%E4%BB%96">其他</a></li></ul><p>此外，我們還通過 <a href="https://pre-commit.ci/" target="_blank" rel="noopener noreferrer">pre-commit.ci</a> 實現了代碼的自動格式化和圖片資源的自動優化，它在發起 PR 後會自動執行，一般無需特別在意。</p><h2 id="github-action-部分" tabindex="-1"><a class="header-anchor" href="#github-action-部分"><span>Github Action 部分</span></a></h2><h3 id="代碼測試" tabindex="-1"><a class="header-anchor" href="#代碼測試"><span>代碼測試</span></a></h3><p><code>smoke-testing.yml</code></p><p>本工作流主要負責對 MaaCore 做出基本的檢測，包括資源文件加載，部分簡單 task 運行測試等等。</p><p>由於測試用例已經較久沒有更新，該工作流現在基本是為了保證資源文件不會出現錯誤，以及 MaaCore 的代碼沒有出現影響到構建的致命性錯誤。</p><h3 id="代碼構建" tabindex="-1"><a class="header-anchor" href="#代碼構建"><span>代碼構建</span></a></h3><p><code>ci.yml</code></p><p>本工作流負責對代碼進行全量構建工作，包含 MAA 的所有組件，構建成品即為可運行的 MAA。</p><p>除了必要的 MaaCore 外，Windows 構建產物會包含 MaaWpfGui，MacOS 構建產物會包含 MaaMacGui，Linux 構建產物會包含 MaaCLI。</p><p>該工作流在出現任何新 Commit 以及 PR 時都會自動運行，且當該工作流由發版 PR 觸發時，本次的構建產物將會直接用於發版，並且會創建一個 Release。</p><h3 id="代碼安全檢查" tabindex="-1"><a class="header-anchor" href="#代碼安全檢查"><span>代碼安全檢查</span></a></h3><p>代碼安全檢查通過 CodeQL 對代碼和工作流進行安全分析，具體工作流如下：</p><p><code>codeql-core.yml</code></p><p>本工作流負責對 MaaCore 和 MaaWpfGui 的 C++ 和 C# 代碼進行安全分析，檢測潛在的安全漏洞。</p><p>該工作流在修改相關源代碼的 PR 時自動運行，同時每天 UTC 時間 11:45 自動執行定期檢查。</p><p><code>codeql-wf.yml</code></p><p>本工作流負責對 GitHub Actions 工作流文件本身進行安全分析，確保 CI/CD 流程的安全性。</p><p>該工作流在修改工作流文件的 PR 時自動運行，同時每天 UTC 時間 12:00 自動執行定期檢查。</p><h3 id="版本發布" tabindex="-1"><a class="header-anchor" href="#版本發布"><span>版本發布</span></a></h3><p>版本發布，簡稱發版，是向用戶發布更新的必要操作，由以下工作流組成：</p><ul><li><code>release-nightly-ota.yml</code> 發布內測版</li><li><code>release-ota.yml</code> 發布正式版/公測版 <ul><li><code>release-preparation.yml</code> 為正式版/公測版生成 changelog 和準備發布</li><li><code>pr-auto-tag.yml</code> 對正式版/公測版生成 tag</li></ul></li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>上述文件名內的 ota 意為 Over-the-Air，也就是我們常說的「增量更新包」，因此 MAA 的發版過程實際上包含了對過往版本構建 OTA 包的步驟</p></div><h4 id="內測版" tabindex="-1"><a class="header-anchor" href="#內測版"><span>內測版</span></a></h4><p><code>release-nightly-ota.yml</code></p><p>本工作流會在每天 UTC 時間 22 點自動運行，以保證內測版的發版頻率。當然，你也可以在做出更改需要驗證時手動發版。</p><p>需要注意的是，內測版的發布僅針對 Windows 用戶，MacOS 與 Linux 用戶並不能接收到內測更新。</p><h4 id="正式版-公測版" tabindex="-1"><a class="header-anchor" href="#正式版-公測版"><span>正式版/公測版</span></a></h4><p>這兩個通道的發版流程相對複雜一點，我們通過模擬一次發版步驟來解釋各工作流的作用：</p><ol><li>建立由 <code>dev</code> 到 <code>master</code> 分支的 pr，且該 pr 的名字需要為 <code>Release v******</code></li><li><code>release-preparation.yml</code> 會生成最近的正式版/公測版到當前版本的 changelog（以一個新 pr 的形式）</li><li>對 changelog 進行手動調整，並且添加簡要描述</li><li>合併 pr，觸發 <code>pr-auto-tag.yml</code>，創建 tag 並且同步分支</li><li>Release 事件觸發 <code>release-ota.yml</code>，對 master 打完 tag 後進行 ota 包的構建以及附件上傳</li></ol><h3 id="資源更新" tabindex="-1"><a class="header-anchor" href="#資源更新"><span>資源更新</span></a></h3><p>這部分工作流主要負責 MAA 的資源更新以及優化，具體工作流如下：</p><ul><li><code>res-update-game.yml</code> 定期執行，從指定的倉庫拉取遊戲資源</li><li><code>sync-resource.yml</code> 將資源同步到 MaaResource 倉庫，用於資源更新</li><li><code>optimize-templates.yml</code> 優化包括模板圖在內的圖片大小</li></ul><h3 id="網站構建" tabindex="-1"><a class="header-anchor" href="#網站構建"><span>網站構建</span></a></h3><p><code>website-workflow.yml</code></p><p>本工作流主要負責 MAA 文檔站的構建與發布。</p><p>請注意，網站的發布與發版強綁定，平常修改網頁組件的時候只會進行構建以保證不會有錯誤，在發版時才會正式部署到 GitHub Pages 上。</p><h3 id="issues-管理" tabindex="-1"><a class="header-anchor" href="#issues-管理"><span>Issues 管理</span></a></h3><p><code>issue-checker.yml</code></p><p>通過正則匹配給各個 Issue 打 Tag，以此來分類標記 Issue 內容，方便查看與管理。</p><p><code>issue-checkbox-checker.yml</code></p><p>通過正則匹配自動關閉勾選「我未仔細閱讀」的 Issue；若「我未仔細閱讀」未被勾選，則將所有勾選框折疊。</p><p><code>stale.yml</code></p><p>檢查超過 90 天沒有活動的 Bug Issue，將其標記並發起通知，7 天後若還沒有活動則關閉。</p><h3 id="pull-requests-管理" tabindex="-1"><a class="header-anchor" href="#pull-requests-管理"><span>Pull Requests 管理</span></a></h3><p><code>pr-checker.yml</code></p><p>該工作流用於檢查 PR 中的 Commit Message 是否符合 <a href="https://www.conventionalcommits.org/zh-hans/v1.0.0/" target="_blank" rel="noopener noreferrer">約定式提交</a>，以及是否包含 Merge Commit，若上述條件符合則會作出提示。</p><h3 id="mirrorchyan-相關" tabindex="-1"><a class="header-anchor" href="#mirrorchyan-相關"><span>MirrorChyan 相關</span></a></h3><p>MirrorChyan 是有償的更新鏡像服務，與其相關的工作流如下：</p><ul><li><code>release-package-distribution.yml</code> 同步更新包到 MirrorChyan</li><li><code>mirrorchyan_release_note.yml</code> 生成 MirrorChyan 的 Release Note</li></ul><h3 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h3><p><code>markdown-checker.yml</code></p><p>負責檢查倉庫中的所有 Markdown 文件中是否包含無效鏈接。</p><p><code>blame-ignore.yml</code></p><p>自動忽略 Commit Message 包含 <code>blame ignore</code> 的提交，保證倉庫歷史的乾淨。</p><p><code>cache-delete.yml</code></p><p>在 PR 合併後清理相關的緩存，以此來節省緩存用量。</p><p><code>update-submodules.yml</code></p><p>定期更新 MaaMacGui 和 maa-cli 等子模組到最新版本。該工作流每天 UTC 時間 21:50 自動執行（在每日內測版發布之前），確保子模組保持最新狀態。</p>',64)])])}const n=a(l,[["render",i]]),s=JSON.parse('{"path":"/zh-tw/develop/ci-tutorial.html","title":"CI 系統解析","lang":"zh-TW","frontmatter":{"order":7,"icon":"devicon-plain:githubactions","title":"CI 系統解析","description":"MAA 借助 Github Action 完成了大量的自動化工作，包括網站的構建，自動更新資源，最終文件的構建與發版等等過程。隨著時間的推移，這些 CI 逐漸開始嵌套，部分甚至引向了其他的存儲庫。本文檔旨在為想要對 MAA 的 CI 系統做出改進的各位做一個簡要的介紹。 閱讀本文之前，最好對 MAA 的項目結構以及組成有一個基本的概念。 提示 你可以通...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CI 系統解析\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://docs.maa.plus/zh-tw/develop/ci-tutorial.html"}],["meta",{"property":"og:site_name","content":"MAA 文件站"}],["meta",{"property":"og:title","content":"CI 系統解析"}],["meta",{"property":"og:description","content":"MAA 借助 Github Action 完成了大量的自動化工作，包括網站的構建，自動更新資源，最終文件的構建與發版等等過程。隨著時間的推移，這些 CI 逐漸開始嵌套，部分甚至引向了其他的存儲庫。本文檔旨在為想要對 MAA 的 CI 系統做出改進的各位做一個簡要的介紹。 閱讀本文之前，最好對 MAA 的項目結構以及組成有一個基本的概念。 提示 你可以通..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-TW"}],["meta",{"property":"og:locale:alternate","content":"ko-KR"}],["meta",{"property":"og:locale:alternate","content":"ja-JP"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["link",{"rel":"alternate","hreflang":"ko-kr","href":"https://docs.maa.plus/ko-kr/develop/ci-tutorial.html"}],["link",{"rel":"alternate","hreflang":"ja-jp","href":"https://docs.maa.plus/ja-jp/develop/ci-tutorial.html"}],["link",{"rel":"alternate","hreflang":"en-us","href":"https://docs.maa.plus/en-us/develop/ci-tutorial.html"}],["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://docs.maa.plus/zh-cn/develop/ci-tutorial.html"}]]},"readingTime":{"minutes":5.36,"words":1609},"git":{"createdTime":1768050475000},"autoDesc":true,"filePathRelative":"zh-tw/develop/ci-tutorial.md","headers":[]}');export{n as comp,s as data};
