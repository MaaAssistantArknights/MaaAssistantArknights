<UserControl
    x:Class="MaaWpfGui.Views.UserControl.TaskQueue.FightSettingsUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:controls="clr-namespace:MaaWpfGui.Styles.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dd="urn:gong-wpf-dragdrop"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:helper="clr-namespace:MaaWpfGui.Helper"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:s="https://github.com/canton7/Stylet"
    xmlns:task="clr-namespace:MaaWpfGui.Configuration.Single.MaaTask"
    xmlns:taskQueue_vms="clr-namespace:MaaWpfGui.ViewModels.UserControl.TaskQueue"
    xmlns:ui_vms="clr-namespace:MaaWpfGui.ViewModels.UI"
    d:Background="White"
    d:DataContext="{d:DesignInstance {x:Type taskQueue_vms:FightSettingsUserControlModel}}"
    d:DesignWidth="220"
    s:View.ActionTarget="{Binding}"
    mc:Ignorable="d">
    <StackPanel>
        <Grid d:Visibility="Visible" Visibility="{c:Binding !EnableAdvancedSettings, Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" MinWidth="100" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Vertical">
                    <CheckBox
                        Height="30"
                        Margin="6"
                        VerticalContentAlignment="Center"
                        Content="{DynamicResource UseSanityPotion}"
                        IsChecked="{Binding UseMedicine}"
                        IsEnabled="{c:Binding !UseStoneDisplay}"
                        MouseRightButtonUp="{s:Action ToggleCheckBoxNullOnRightClick,
                                                      Target={x:Type helper:CheckBoxHelper}}"
                        ToolTip="{DynamicResource CheckBoxesNotSavedAsNull}" />
                    <CheckBox
                        Height="30"
                        Margin="6"
                        VerticalContentAlignment="Center"
                        Content="{c:Binding 'UseStoneString + (AllowUseStoneSave ? &quot;&quot; : &quot;*&quot;)'}"
                        IsChecked="{Binding UseStone}"
                        MouseRightButtonUp="{s:Action ToggleCheckBoxNullOnRightClick,
                                                      Target={x:Type helper:CheckBoxHelper}}"
                        ToolTip="{DynamicResource CheckBoxesNotSaved}" />
                    <CheckBox
                        Height="30"
                        Margin="6"
                        VerticalContentAlignment="Center"
                        Content="{DynamicResource PerformBattles}"
                        IsChecked="{Binding HasTimesLimited}"
                        MouseRightButtonUp="{s:Action ToggleCheckBoxNullOnRightClick,
                                                      Target={x:Type helper:CheckBoxHelper}}"
                        ToolTip="{DynamicResource CheckBoxesNotSavedAsNull}" />
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Vertical">
                    <hc:NumericUpDown
                        Width="70"
                        Height="30"
                        Margin="6"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        IsEnabled="{c:Binding !UseStoneDisplay}"
                        Maximum="999"
                        Minimum="0"
                        Value="{Binding MedicineNumber, UpdateSourceTrigger=PropertyChanged}" />
                    <hc:NumericUpDown
                        Width="70"
                        Height="30"
                        Margin="6"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        Maximum="999"
                        Minimum="0"
                        Value="{Binding StoneNumber, UpdateSourceTrigger=PropertyChanged}" />
                    <hc:NumericUpDown
                        Width="70"
                        Height="30"
                        Margin="6"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        Maximum="999"
                        Minimum="0"
                        Value="{Binding MaxTimes, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
            </Grid>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" MinWidth="100" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Vertical">
                    <Grid Margin="6">
                        <CheckBox
                            Height="30"
                            VerticalContentAlignment="Center"
                            Content="{DynamicResource AssignedMaterial}"
                            IsChecked="{Binding IsSpecifiedDrops}"
                            MouseRightButtonUp="{s:Action ToggleCheckBoxNullOnRightClick,
                                                          Target={x:Type helper:CheckBoxHelper}}"
                            ToolTip="{DynamicResource CheckBoxesNotSavedAsNull}" />
                        <controls:TooltipBlock
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            NormalOpacity="0.25"
                            TooltipText="{DynamicResource SpecifiedDropsTip}" />
                    </Grid>
                    <Grid Height="42" Visibility="{c:Binding IsSpecifiedDrops}">
                        <controls:TextBlock
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Text="{DynamicResource Quantity}"
                            TextAlignment="Center" />
                    </Grid>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Vertical">
                    <ComboBox
                        Height="30"
                        Margin="6"
                        VerticalContentAlignment="Center"
                        DisplayMemberPath="Display"
                        DropDownClosed="{s:Action DropsListDropDownClosed}"
                        IsEditable="True"
                        IsTextSearchEnabled="False"
                        ItemsSource="{Binding DropsList}"
                        Loaded="{s:Action MakeComboBoxSearchable,
                                          Target={x:Type ui_vms:SettingsViewModel}}"
                        SelectedValue="{Binding DropsItemId}"
                        SelectedValuePath="Value"
                        Text="{Binding DropsItemName}" />
                    <hc:NumericUpDown
                        Height="30"
                        MinWidth="60"
                        Margin="6"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        Maximum="1145141919"
                        Minimum="1"
                        Visibility="{c:Binding IsSpecifiedDrops}"
                        Value="{Binding DropsQuantity, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
            </Grid>
            <Grid Grid.Row="2" Visibility="{c:Binding !HideSeries}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Vertical">
                    <Grid Height="42">
                        <controls:TextBlock
                            x:Name="SeriesTextBlock"
                            Margin="0,6"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Text="{DynamicResource Series}"
                            TextAlignment="Center"
                            TextWrapping="Wrap" />
                        <controls:TooltipBlock
                            Margin="0,5,6,0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            NormalOpacity="0.25"
                            TooltipText="{DynamicResource SeriesTip}" />
                    </Grid>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Vertical">
                    <ComboBox
                        Height="30"
                        Margin="6"
                        VerticalContentAlignment="Center"
                        d:IsHitTestVisible="True"
                        DisplayMemberPath="Display"
                        IsHitTestVisible="{c:Binding !IsCurrentTaskRunning,
                                                     Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}"
                        ItemsSource="{Binding SeriesList}"
                        SelectedValue="{Binding Series}"
                        SelectedValuePath="Value" />
                </StackPanel>
            </Grid>
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <controls:TextBlock
                    Margin="6,15"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Text="{DynamicResource StageSelect2}"
                    TextAlignment="Center"
                    TextWrapping="Wrap" />

                <ListBox
                    Grid.Column="1"
                    Margin="6,5"
                    HorizontalContentAlignment="Stretch"
                    d:ItemsSource="{d:SampleData ItemCount=3}"
                    dd:DragDrop.DragDropContext="{Binding RelativeSource={RelativeSource Self}}"
                    dd:DragDrop.IsDragSource="True"
                    dd:DragDrop.IsDropTarget="True"
                    ItemsSource="{Binding Path=StagePlan}"
                    PreviewMouseWheel="{s:Action RouteMouseWheelToParent,
                                                 Target={x:Type helper:MouseWheelHelper}}"
                    Style="{DynamicResource NoSelectedHighlightListBoxStyle}"
                    ToolTip="{DynamicResource LabelSequenceTip}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <controls:TextBlock
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Opacity="{c:Binding 'IsOpen ? 1 : 0.5'}"
                                    Text="{Binding Display}" />
                                <Button
                                    Grid.Column="1"
                                    Margin="0"
                                    Padding="5,0,10,0"
                                    hc:IconElement.Geometry="{StaticResource CloseGeometry}"
                                    hc:VisualElement.HighlightBackground="Transparent"
                                    hc:VisualElement.HighlightForeground="{DynamicResource PrimaryBrush}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="{s:Action RemoveStageFromPlan}"
                                    CommandParameter="{c:Binding Index}" />
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
            <Grid Grid.Row="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Vertical">
                    <Grid>
                        <Button
                            Margin="6"
                            Command="{s:Action AddStageToPlan}"
                            Content="{DynamicResource AddStage}" />
                        <Grid Visibility="{c:Binding CustomStageCode}">
                            <controls:TooltipBlock
                                Margin="0,5,6,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                NormalOpacity="0.25"
                                TooltipText="{DynamicResource CustomStageCodeTip}" />
                        </Grid>
                    </Grid>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Vertical">
                    <StackPanel
                        IsEnabled="{c:Binding !CustomStageCode}"
                        Orientation="Vertical"
                        Visibility="{c:Binding !CustomStageCode}">
                        <ComboBox
                            Height="30"
                            Margin="6"
                            VerticalContentAlignment="Center"
                            d:IsHitTestVisible="True"
                            DisplayMemberPath="Display"
                            IsHitTestVisible="{c:Binding !IsCurrentTaskRunning,
                                                         Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}"
                            ItemsSource="{Binding StageListSource}"
                            SelectedValue="{Binding Stage}"
                            SelectedValuePath="Value" />
                    </StackPanel>
                    <StackPanel
                        IsEnabled="{c:Binding CustomStageCode}"
                        Orientation="Vertical"
                        Visibility="{c:Binding CustomStageCode}">
                        <TextBox
                            Height="30"
                            Margin="6"
                            VerticalContentAlignment="Center"
                            d:IsHitTestVisible="True"
                            hc:InfoElement.Placeholder="{DynamicResource DefaultStage}"
                            IsHitTestVisible="{c:Binding !IsCurrentTaskRunning,
                                                         Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}"
                            Text="{Binding Stage1}"
                            ToolTip="{DynamicResource CustomStageCodeTip}" />
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Grid>

        <StackPanel d:Visibility="Visible" Visibility="{c:Binding EnableAdvancedSettings, Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}">
            <StackPanel>
                <CheckBox
                    Margin="0,10"
                    Content="{DynamicResource UseCustomAnnihilation}"
                    IsChecked="{Binding UseCustomAnnihilation}" />
                <ComboBox
                    Height="30"
                    d:IsHitTestVisible="True"
                    DisplayMemberPath="Key"
                    IsHitTestVisible="{c:Binding !IsCurrentTaskRunning,
                                                 Source={x:Static ui_vms:TaskQueueViewModel.TaskSettingVisibilities}}"
                    ItemsSource="{Binding AnnihilationModeList}"
                    SelectedValue="{Binding AnnihilationStage}"
                    SelectedValuePath="Value"
                    Visibility="{c:Binding UseCustomAnnihilation}" />
            </StackPanel>
            <StackPanel Margin="0,10" Orientation="Horizontal">
                <CheckBox Content="{DynamicResource DrGrandet}" IsChecked="{Binding IsDrGrandet}" />
                <controls:TooltipBlock TooltipText="{DynamicResource DrGrandetTip}" />
            </StackPanel>
            <StackPanel Margin="0,10" Orientation="Horizontal">
                <CheckBox Content="{DynamicResource CustomStageCode}" IsChecked="{Binding CustomStageCode}" />
                <controls:TooltipBlock TooltipText="{DynamicResource CustomStageCodeTip}" />
            </StackPanel>
            <CheckBox
                Margin="0,10"
                Content="{DynamicResource AllowUseStoneSave}"
                IsChecked="{Binding AllowUseStoneSave}" />
            <CheckBox Margin="0,10" IsChecked="{Binding UseExpiringMedicine}">
                <TextBlock
                    Block.TextAlignment="Left"
                    Text="{DynamicResource UseExpiringMedicine}"
                    TextWrapping="Wrap" />
            </CheckBox>
            <CheckBox
                Margin="0,10"
                Content="{DynamicResource HideUnavailableStage}"
                IsChecked="{Binding HideUnavailableStage}" />
            <CheckBox
                Margin="0,10"
                Content="{DynamicResource HideSeries}"
                IsChecked="{Binding HideSeries}" />
            <ListBox
                Margin="6,5"
                HorizontalContentAlignment="Stretch"
                d:ItemsSource="{d:SampleData ItemCount=3}"
                ItemsSource="{Binding Path=WeeklyScheduleSource}"
                PreviewMouseWheel="{s:Action RouteMouseWheelToParent,
                                             Target={x:Type helper:MouseWheelHelper}}"
                ScrollViewer.VerticalScrollBarVisibility="Disabled">
                <ListBox.Style>
                    <Style BasedOn="{StaticResource NoSelectedHighlightListBoxStyle}" TargetType="ListBox">
                        <Setter Property="MaxHeight" Value="50" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetProperty="MaxHeight"
                                                To="300"
                                                Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetProperty="MaxHeight"
                                                To="50"
                                                Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseIn" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.Style>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <CheckBox
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Content="{Binding Display}"
                            IsChecked="{Binding Value}" />
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <CheckBox
                Margin="0,10"
                Content="{DynamicResource AutoRestartOption}"
                IsChecked="{Binding AutoRestartOnDrop}" />
        </StackPanel>
    </StackPanel>
</UserControl>
