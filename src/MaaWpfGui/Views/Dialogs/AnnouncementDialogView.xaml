<hc:Window
    x:Class="MaaWpfGui.Views.Dialogs.AnnouncementDialogView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dialogs="clr-namespace:MaaWpfGui.ViewModels.Dialogs"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:helper="clr-namespace:MaaWpfGui.Helper"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mdxam="clr-namespace:MdXaml;assembly=MdXaml"
    xmlns:s="https://github.com/canton7/Stylet"
    xmlns:styles="clr-namespace:MaaWpfGui.Styles"
    Title="{DynamicResource Announcement}"
    Width="750"
    Height="550"
    MinWidth="750"
    MinHeight="550"
    d:DataContext="{d:DesignInstance {x:Type dialogs:AnnouncementDialogViewModel}}"
    Icon="../../newlogo.ico"
    ShowCloseButton="False"
    ShowMinButton="False"
    mc:Ignorable="d">
    <Grid Background="{DynamicResource MdXamlBackground}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ListBox
                d:ItemsSource="{d:SampleData ItemCount=7}"
                ItemsSource="{Binding AnnouncementSections}"
                SelectedItem="{Binding SelectedAnnouncementSection}">
                <hc:Interaction.Triggers>
                    <hc:EventTrigger EventName="SelectionChanged">
                        <hc:InvokeCommandAction Command="{Binding ScrollToTopCommand}" CommandParameter="{Binding ElementName=ScrollViewer}" />
                    </hc:EventTrigger>
                </hc:Interaction.Triggers>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Padding="5"
                                Text="{Binding Title}"
                                TextWrapping="Wrap" />
                            <TextBlock
                                Grid.Column="1"
                                Margin="-8,-5,-5,0"
                                Padding="5"
                                Foreground="Red"
                                Text="â—"
                                Visibility="{c:Binding IsNew}" />
                        </Grid>

                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <Image
                Grid.Row="1"
                d:Source="/Res/Img/NoSkland.jpg"
                Source="{Binding ImageSource}" />
        </Grid>
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <hc:ScrollViewer
                x:Name="ScrollViewer"
                Grid.Row="0"
                Grid.RowSpan="2"
                Margin="10,5,10,0"
                IsInertiaEnabled="True"
                PanningMode="Both">
                <hc:Interaction.Triggers>
                    <hc:EventTrigger EventName="ScrollChanged">
                        <hc:InvokeCommandAction Command="{Binding UpdateScrollStateCommand}" CommandParameter="{Binding ElementName=ScrollViewer}" />
                    </hc:EventTrigger>
                </hc:Interaction.Triggers>
                <mdxam:MarkdownScrollViewer
                    d:Markdown="#Test&#10;This is a test text.&#10;&#10;~~This is a test text~~&#10;&#10;*This is a test text*&#10;&#10;**This is a test text**"
                    ClickAction="SafetyOpenBrowser"
                    Markdown="{Binding SelectedAnnouncementSection.Content}"
                    PreviewMouseWheel="{s:Action RouteMouseWheelToParent,
                                                 Target={x:Type helper:MouseWheelHelper}}">
                    <mdxam:MarkdownScrollViewer.MarkdownStyle>
                        <StaticResource ResourceKey="MdXamlStyle" />
                    </mdxam:MarkdownScrollViewer.MarkdownStyle>
                    <mdxam:MarkdownScrollViewer.Plugins>
                        <StaticResource ResourceKey="MdXamlPlugin" />
                    </mdxam:MarkdownScrollViewer.Plugins>
                </mdxam:MarkdownScrollViewer>
            </hc:ScrollViewer>

            <Border
                Grid.Row="1"
                Height="20"
                Margin="0,0,18,0"
                HorizontalAlignment="Stretch"
                Background="{DynamicResource MdXamlBackground}"
                IsHitTestVisible="False"
                Visibility="{c:Binding !IsScrolledToBottom,
                                       FalseToVisibility=Hidden}">
                <Border.OpacityMask>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="Transparent" />
                        <GradientStop Offset="1" Color="Black" />
                    </LinearGradientBrush>
                </Border.OpacityMask>
            </Border>

            <StackPanel
                Grid.Row="2"
                Margin="0,0,0,10"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <CheckBox
                    Height="30"
                    Margin="10,0"
                    HorizontalAlignment="Center"
                    VerticalContentAlignment="Center"
                    IsChecked="{Binding DoNotRemindThisAnnouncementAgain}"
                    IsEnabled="{c:Binding 'HasEverScrolledToBottom or DoNotRemindThisAnnouncementAgain'}">
                    <TextBlock
                        MaxWidth="150"
                        Text="{DynamicResource DoNotRemindThisAnnouncementAgain}"
                        TextWrapping="Wrap" />
                </CheckBox>
                <Button
                    Grid.Column="1"
                    Height="Auto"
                    MinWidth="100"
                    MinHeight="50"
                    Margin="10,0"
                    Command="{s:Action Close}">
                    <TextBlock
                        MaxWidth="150"
                        d:Text="{DynamicResource Confirm}"
                        Text="{Binding ButtonContent}"
                        TextWrapping="Wrap" />
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</hc:Window>
